<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
    <title>Waitlist Signup</title>
    <style>
        #message {
            display: none;
            margin: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }

        .navbar-item input.input {
            max-width: 250px;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar is-light" role="navigation" aria-label="main navigation" style="background-color: aqua;">
        <div class="navbar-brand" style="padding-left: 1rem;">
            <div class="navbar-item" style="
        font-size: 1.1rem;
        color: #363636;
        font-weight: 500;
      ">
                If you want a site like this within minutes,
                <strong style="color: #ffffff; margin-left: 0.3rem;">
                    Join the waitlist: <span>and Discord: <a href="https://discord.gg/Jupfm5zyNf">Server</a></span>
                </strong>
            </div>
        </div>

        <div class="navbar-menu is-active">
            <div class="navbar-end">
                <div class="navbar-item">
                    <form id="form" class="is-flex" style="gap: 10px;">
                        <input class="input" type="email" placeholder="Your Email" name="Email" required />
                        <button class="button is-primary" type="submit" id="submit-button">
                            Join Waitlist
                        </button>
                        <button class="button is-danger" type="button"
                            onclick="document.getElementById('form').reset();">
                            Cancel
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <!-- Message area -->
    <div class="container">
        <div id="message"></div>
    </div>
    <iframe src="portfolio.html" style="width: 100vw; height:100vh;">Anit</iframe>

    <script>
        const form = document.getElementById("form");
        const submitButton = document.getElementById("submit-button");
        const messageDiv = document.getElementById("message");

        form.addEventListener("submit", async function (e) {
            e.preventDefault();

            messageDiv.textContent = "Submitting...";
            messageDiv.style.display = "block";
            messageDiv.style.backgroundColor = "beige";
            messageDiv.style.color = "black";
            submitButton.disabled = true;
            submitButton.classList.add("is-loading");

            try {
                const formData = new FormData(this);
                const formDataObj = {};

                for (let [key, value] of formData.entries()) {
                    formDataObj[key] = value;
                }

                const email = formDataObj.Email;

                // const checkEmail = `https://cors-anywhere.herokuapp.com/https://isfakemail.com/api/check?url=${email}`;
                // const validCheck = await fetch(checkEmail, {
                //     method: "GET", // GET is default, so this is optional
                //     headers: {
                //         // No special headers needed unless API requires them
                //     },
                // })

                // const checkData = await validCheck.json();
                // console.log(checkData)

                // if (checkData.isDisposable !== true) {
                //     throw new Error("Submission only allowed for temporary email domains");
                //     alert(checkData)
                // }

                const scriptURL =
                    "https://script.google.com/macros/s/AKfycbzjSTsKiwYD3nk8Rv7_8dPcZDJ0QLKsm11xBJL-ktwamVPSTUPtpfqXR3Fr49F-6DGp/exec";

                const response = await fetch(scriptURL, {
                    redirect: "follow",
                    method: "POST",
                    body: JSON.stringify(formDataObj),
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8",
                    },
                });

                const data = await response.json();

                if (data.status === "success") {
                    messageDiv.textContent =
                        data.message || "Joined Waitlist successfully!";
                    messageDiv.style.backgroundColor = "#48c78e";
                    messageDiv.style.color = "white";
                    form.reset();

                } else {
                    throw new Error(data.message || "Submission failed");
                }
            } catch (error) {
                console.error("Error:", error);
                messageDiv.textContent = "Error: " + error.message;
                messageDiv.style.backgroundColor = "#f14668";
                messageDiv.style.color = "white";
            } finally {
                submitButton.disabled = false;
                submitButton.classList.remove("is-loading");

                setTimeout(() => {
                    messageDiv.textContent = "";
                    messageDiv.style.display = "none";
                }, 4000);
            }
        });

        const cancelButton = form.querySelector("button.is-danger");
        cancelButton.addEventListener("click", function () {
            form.reset();
            messageDiv.style.display = "none";
        });
    </script>
</body>

</html>